!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Spinner=t()}(this,function(){"use strict";function e(e,t){var n,o=document.createElement(e||"div");for(n in t)o[n]=t[n];return o}function t(e){for(var t=1,n=arguments.length;n>t;t++)e.appendChild(arguments[t]);return e}function n(e,t,n,o){var a=["opacity",t,~~(100*e),n,o].join("-"),i=.01+n/o*100,r=Math.max(1-(1-e)/t*(100-i),e),s=l.substring(0,l.indexOf("Animation")).toLowerCase(),c=s&&"-"+s+"-"||"";return u[a]||(d.insertRule("@"+c+"keyframes "+a+"{0%{opacity:"+r+"}"+i+"%{opacity:"+e+"}"+(i+.01)+"%{opacity:1}"+(i+t)%100+"%{opacity:"+e+"}100%{opacity:"+r+"}}",d.cssRules.length),u[a]=1),a}function o(e,t){var n,o,a=e.style;if(t=t.charAt(0).toUpperCase()+t.slice(1),void 0!==a[t])return t;for(o=0;o<c.length;o++)if(n=c[o]+t,void 0!==a[n])return n}function a(e,t){for(var n in t)e.style[o(e,n)||n]=t[n];return e}function i(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)void 0===e[o]&&(e[o]=n[o])}return e}function r(e,t){return"string"==typeof e?e:e[t%e.length]}function s(e){this.opts=i(e||{},s.defaults,p)}var l,d,c=["webkit","Moz","ms","O"],u={},p={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(s.defaults={},i(s.prototype,{spin:function(t){this.stop();var n=this,o=n.opts,i=n.el=e(null,{className:o.className});if(a(i,{position:o.position,width:0,zIndex:o.zIndex,left:o.left,top:o.top}),t&&t.insertBefore(i,t.firstChild||null),i.setAttribute("role","progressbar"),n.lines(i,n.opts),!l){var r,s=0,d=(o.lines-1)*(1-o.direction)/2,c=o.fps,u=c/o.speed,p=(1-o.opacity)/(u*o.trail/100),g=u/o.lines;!function e(){s++;for(var t=0;t<o.lines;t++)r=Math.max(1-(s+(o.lines-t)*g)%u*p,o.opacity),n.opacity(i,t*o.direction+d,r,o);n.timeout=n.el&&setTimeout(e,~~(1e3/c))}()}return n},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(o,i){function s(t,n){return a(e(),{position:"absolute",width:i.scale*(i.length+i.width)+"px",height:i.scale*i.width+"px",background:t,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/i.lines*c+i.rotate)+"deg) translate("+i.scale*i.radius+"px,0)",borderRadius:(i.corners*i.scale*i.width>>1)+"px"})}for(var d,c=0,u=(i.lines-1)*(1-i.direction)/2;c<i.lines;c++)d=a(e(),{position:"absolute",top:1+~(i.scale*i.width/2)+"px",transform:i.hwaccel?"translate3d(0,0,0)":"",opacity:i.opacity,animation:l&&n(i.opacity,i.trail,u+c*i.direction,i.lines)+" "+1/i.speed+"s linear infinite"}),i.shadow&&t(d,a(s("#000","0 0 4px #000"),{top:"2px"})),t(o,t(d,s(r(i.color,c),"0 0 1px rgba(0,0,0,.1)")));return o},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}}),"undefined"!=typeof document){d=function(){var n=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],n),n.sheet||n.styleSheet}();var g=a(e("group"),{behavior:"url(#default#VML)"});!o(g,"transform")&&g.adj?function(){function n(t,n){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',n)}d.addRule(".spin-vml","behavior:url(#default#VML)"),s.prototype.lines=function(e,o){function i(){return a(n("group",{coordsize:c+" "+c,coordorigin:-d+" "+-d}),{width:c,height:c})}function s(e,s,l){t(p,t(a(i(),{rotation:360/o.lines*e+"deg",left:~~s}),t(a(n("roundrect",{arcsize:o.corners}),{width:d,height:o.scale*o.width,left:o.scale*o.radius,top:-o.scale*o.width>>1,filter:l}),n("fill",{color:r(o.color,e),opacity:o.opacity}),n("stroke",{opacity:0}))))}var l,d=o.scale*(o.length+o.width),c=2*o.scale*d,u=-(o.width+o.length)*o.scale*2+"px",p=a(i(),{position:"absolute",top:u,left:u});if(o.shadow)for(l=1;l<=o.lines;l++)s(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=o.lines;l++)s(l);return t(e,p)},s.prototype.opacity=function(e,t,n,o){var a=e.firstChild;o=o.shadow&&o.lines||0,a&&t+o<a.childNodes.length&&(a=a.childNodes[t+o],a=a&&a.firstChild,(a=a&&a.firstChild)&&(a.opacity=n))}}():l=o(g,"animation")}return s});var pageControllerModule=function(e){var t={};return t.editHandler=function(){var t=e(this).data("complete-path");t.username=JSON.parse(sessionStorage.getItem("rev_auth")).username;var n=JSON.parse(sessionStorage.getItem("rev_auth")).access_token,o=document.querySelector('[data-category="'+e(this).attr("data-category")+'"');o.hasAttribute("id",t.xpath)||(o.setAttribute("id",t.xpath),CKEDITOR.config.inlinesave={postUrl:DEV_CONFIG+"revenant_page/page_content",postAuth:"Bearer "+n,postData:{data:t},useJson:!0,onSave:function(e){return e.destroy(),o.removeAttribute("contenteditable"),!0},onSuccess:function(e,t){console.log("save successful",e,t)},onFailure:function(e,t,n){console.log("save failed",e,t,n)},useJSON:!0,useColorIcon:!1},CKEDITOR.inline(o,{bodyId:t,extraPlugins:"inlinesave,image,widgetselection,widget,filetools,lineutils,notification,notificationaggregator,uploadwidget,uploadimage",imageUploadUrl:DEV_CONFIG+"revenant_page/page_content/image?type=Images",postAuth:"Bearer "+n,allowedContent:!0,toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker","editing"]},{name:"links",groups:["links"]},{name:"forms",groups:["forms"]},{name:"tools",groups:["tools"]},{name:"others",groups:["others"]},{name:"insert",groups:["insert"]},"/",{name:"document",groups:["mode","document","doctools"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi","paragraph"]},{name:"styles",groups:["styles"]},{name:"colors",groups:["colors"]},{name:"about",groups:["about"]}],removeButtons:"Maximize,Table,Anchor,Indent,Outdent,Blockquote,Styles,Format,About"}))},t.editAddHandler=function(){e(".text--edit").on("click",t.editHandler)},t.loginKeyBind=function(){var t={};onkeydown=onkeyup=function(n){n=n||event,t[n.keyCode]="keydown"==n.type,t[17]&&t[18]&&t[82]&&("none"===e(".rev_login").css("display")?e(".rev_login").fadeIn():e(".rev_login").fadeOut())}},t.skipElements=["SCRIPT","NOSCRIPT","B","SPAN","I","STRONG","EM","A"],t.recurseAdd=function(n){if(n.childNodes.length>0)for(var o=0;o<n.childNodes.length;o++)this.recurseAdd(n.childNodes[o]);if(n.nodeType==Node.TEXT_NODE&&""!=n.nodeValue.trim()&&t.skipElements.indexOf(n.parentNode.nodeName)<=0&&"A"!=n.parentNode.nodeName&&0===e(n).parents(".text--edit").length){var a=pageModule.getCompletePath(n);n.parentNode.className+=" text--edit",n.parentNode.setAttribute("data-category",a.xpath),e('[data-category="'+a.xpath+'"]').data("complete-path",a),n.parentNode.setAttribute("contenteditable","true"),"A"===n.parentNode.nodeName&&(n.parentNode.onclick=function(e){e.preventDefault()})}},t.recurseRemove=function(t){if(t.childNodes.length>0)for(var n=0;n<t.childNodes.length;n++)this.recurseRemove(t.childNodes[n]);var o=pageModule.getCompletePath(t);t.parentNode.classList.remove("text--edit"),e('[data-category="'+o.xpath+'"]').removeData("complete-path"),t.parentNode.removeAttribute("data-category"),t.parentNode.removeAttribute("contenteditable");for(name in CKEDITOR.instances)CKEDITOR.instances[name].destroy(!0);"A"===t.parentNode.nodeName&&(t.parentNode.onclick=null)},t.addEditClass=function(){var e=document.getElementsByTagName("body")[0];t.recurseAdd(e)},t.removeEditClass=function(){var e=document.getElementsByTagName("body")[0];t.recurseRemove(e)},t.appendLogin=function(){!function(){var n=e('<div class="rev_login" style="display: none;"><button class="rev_login_reveal">Revenant</button><div class="rev_login__contaier"><h2>Revenant Login</h2><form class="rev_login__form" method="post" action="submit.data"> <input type="text" title="username" placeholder="username" /><input type="password" title="password" placeholder="password" /><button type="submit" class="btn">Login</button><a class="forgot" href="#">Forgot Username?</a></form></div></div>');e("body").prepend(n),e(".rev_login_reveal").on("click",function(){e(".rev_login__contaier").toggleClass("show"),t.loginAuthenticate()})}()},t.appendControlPanel=function(){var n=JSON.parse(sessionStorage.getItem("rev_auth")),o=function(t){return e('<div class="rev_user_control_panel"><h4 class="rev_user">Currently Logged in as: '+t+'</h4><button class="rev_logout">Logout of Revenant</button></div>')}(n.username);e("body").prepend(o),e(".rev_logout").on("click",function(){e(".rev_user_control_panel").remove(),e(".text--edit").unbind("click",t.editHandler),t.removeEditClass(),sessionStorage.clear(),t.appendLogin()})},t.loginAuthenticate=function(){e(".rev_login__form").on("submit",function(n){n.preventDefault();var o=e(this).find('input[title="username"]').val(),a=e(this).find('input[title="password"]').val(),i=window.location.host,r={origin:i,username:o,password:a};e.post(DEV_CONFIG+"revenant_page/page_auth",JSON.stringify(r)).error(function(e){console.log("oauth error",e)}).done(function(n,a,i){console.log(n,a,i);var r=JSON.parse(n);sessionStorage.setItem("rev_auth",JSON.stringify({username:o,access_token:r.access_token,refresh_token:r.refresh_token})),pageModule.revenantContentCheck(t.init),e(".rev_login").remove()})})},t.init=function(){console.log("pageControllerInit, add login or handlers"),sessionStorage.getItem("rev_auth")?(t.addEditClass(),t.editAddHandler(),t.appendControlPanel()):(console.log("no rev-auth"),t.appendLogin(),t.loginKeyBind()),e("#spinner-overlay").fadeOut()},{init:t.init}}(jQuery),DEV_CONFIGS={LOCAL:"http://revenant-api.dev/",PROD:"http://revenant-api.bfdig.com/"},DEV_CONFIG=DEV_CONFIGS.PROD,pageModule=function(e){var t={};return t.getText=function(e){return e.parentNode.textContent},t.getElementByXpath=function(e){return document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue},t.getXPath=function(t){for(var n="";t&&1==t.nodeType;t=t.parentNode){var o=e(t.parentNode).children(t.tagName).index(t)+1;o=o>1?"["+o+"]":"",n="/"+t.tagName.toLowerCase()+o+n}return n},t.getCompletePath=function(e){return{url:window.location.hostname+window.location.pathname,xpath:t.getXPath(e.parentNode),title:document.title,oldText:e.parentElement.innerHTML}},t.createRevenantPage=function(t){console.log("inside create page, current revenant",t);var n="Bearer "+JSON.parse(sessionStorage.getItem("rev_auth")).access_token;e.ajax({type:"POST",url:DEV_CONFIG+"revenant_page/page_create",headers:{Accept:"application/json","Content-Type":"application/hal+json",Authorization:n,"X-Requested-With":null},data:JSON.stringify(t),success:function(e,t,n){console.log("revenant create page post success",e)},error:function(e,t,n){console.log("revenant create page post xhr: ",e),console.log("revenant create page post xhr: ",n)}})},t.revenantContentCheck=function(n){e(function(){const o=window.location.hostname+window.location.pathname;e.ajax({method:"GET",url:DEV_CONFIG+"rev-content/?url="+o,success:function(e){if(console.log("revenant content check success",e),!e.length&&sessionStorage.getItem("rev_auth")){var a={};a.title=window.location.hostname+window.location.pathname,a.url=o,t.createRevenantPage(a)}else e.forEach(function(e){if(e&&!e.field_xpath.includes("default")){t.getElementByXpath(e.field_xpath).innerHTML=e.field_new_content}});n&&n()},error:function(e){console.log("revenant content check error: ",e)}})})},t.addCSS=function(){e("<link/>",{rel:"stylesheet",type:"text/css",href:DEV_CONFIG+"/revenant/src/css/main.css"}).appendTo("head")},t.addCKEditor=function(){return e.ajax({url:DEV_CONFIGS.LOCAL+"revenant/lib/ckeditor/ckeditor.js",dataType:"script",cache:!0})},t.ckEditorConfigure=function(){CKEDITOR.plugins.addExternal("inlinesave",DEV_CONFIG+"revenant/lib/ckeditor/plugins/rev-inlinesave/","plugin.js"),CKEDITOR.disableAutoInline=!0,CKEDITOR.dtd.$editable={a:1,address:1,article:1,aside:1,blockquote:1,body:1,details:1,div:1,fieldset:1,figcaption:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,main:1,nav:1,p:1,pre:1,section:1},CKEDITOR.timestamp=Math.random().toString(36).substring(0,5)},t.spinnerLoad=function(){$spinnerDiv=e('<div id="spinner-overlay" style="position: fixed; height: 100%; z-index: 9999; top: 0;bottom: 0;left: 0;right: 0;opacity: .9;background-color: #fff;"><div id="loading-spinner"><div></div>'),e("body").append($spinnerDiv);var t={lines:13,length:28,width:14,radius:42,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"},n=document.getElementById("loading-spinner");new Spinner(t).spin(n)},t.init=function(e){t.spinnerLoad(),t.addCKEditor().done(function(){t.addCSS(),t.ckEditorConfigure(),t.revenantContentCheck(e)})},{revenantContentCheck:t.revenantContentCheck,getCompletePath:t.getCompletePath,init:t.init}}(jQuery);pageModule.init(pageControllerModule.init);
//# sourceMappingURL=map/revenant.min.js.map
